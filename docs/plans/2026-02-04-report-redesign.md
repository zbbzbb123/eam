# 日报 + 周报重新设计

## 背景

当前报告页面问题：宏观数据看不懂、数据不全、不实用、加载慢。需要重新设计为以持仓为核心的实用报告系统。

---

## 核心定位

| | 日报 | 周报 |
|---|---|---|
| **定位** | 收盘后复盘，3-5分钟看完 | 一周汇总 + 中长期展望 |
| **视角** | 当日微观：每只持仓表现 + 短期机会 | 宏观+战略：趋势、仓位调整、新机会 |
| **生成** | 每天2次：17:30（A股收盘后）+ 07:00（美股收盘后） | 每周2次：周六07:00 + 周日22:00 |
| **存储** | 每份独立存储，不覆盖，全市场分析 | 每份独立存储，不覆盖 |
| **AI风格** | 结论+简要理由，可展开详细分析 | 同上，但中长期视角 |

---

## 日报结构

### 1) 持仓总览卡片

- 总市值、今日总盈亏（金额 + 百分比）
- 持仓数量、现金比例
- 一句话AI总结，例："今日持仓整体小幅回调-0.8%，半导体板块拖累较大，无需操作"

### 2) 逐只持仓点评（核心区域）

按今日涨跌幅排序（跌多的排前面，需关注的优先）。每只股票一张卡片：

- **头部**：股票名称、代码、市场标签、仓位占比
- **数据行**：现价、今日涨跌%、持仓盈亏金额、盈亏%
- **AI点评**（默认展示）：2-3句结论+理由，结合仓位比例给建议
  - 例："小米：建议持有。当前PE 18倍处于历史中位，短期受手机出货量不及预期拖累，但汽车业务Q2放量预期未变，跌破45元可补仓"
- **操作建议标签**：持有 / 关注 / 减仓 / 加仓
- **可展开**：详细分析报告（基本面、技术面、催化剂、风险点）
- 接近止损/止盈位时有醒目提示

### 3) 机会雷达

来源：关注列表 + 持仓关联板块扫描。**没有信号时整块隐藏**。

每个机会卡片：
- 标的名称、代码
- 信号类型（超跌反弹 / 估值低位 / 资金流入 / 技术突破等）
- 长期机会 or 短期机会
- 简要理由（B风格），可展开详细分析
- 建议关注价位

---

## 周报结构

### 1) 本周总结卡片

- 本周持仓总盈亏（金额 + 百分比）
- 本周最佳 / 最差持仓
- 一段AI总结：本周市场关键变化 + 持仓整体表现概述

### 2) 宏观环境 + 资金流向

- 宏观评分仪表盘（US + CN）
- 北向资金本周累计流向 + 趋势判断
- 板块资金流入/流出排行
- 本周关键消息/事件摘要

### 3) 中长期持仓点评

逐只卡片，视角为中长期：
- AI点评侧重：持仓逻辑是否还成立、中期催化剂、仓位建议
- 结合宏观和资金面给出战略建议
  - 例："半导体板块资金持续流出3周，建议降低该板块整体仓位至15%以下"

### 4) 新机会发掘

来源：关注列表 + 持仓关联板块热门标的。

每个机会：
- 标的信息 + 入场理由
- 长期/短期标注
- 建议关注价位
- 可展开详细分析

### 5) 风险提醒 + 下周关注

- 集中风险、止损提醒
- 下周重要事件日历（FOMC、财报等）

---

## 前端设计

### 页面结构

`/reports` 页面，顶部 tab 切换「日报」和「周报」。

每个 tab 下是按时间倒序的报告列表：
- **最新一份**：默认展开，显示完整报告内容
- **历史报告**：折叠状态，只显示标题 + 日期 + AI摘要一句话，点击展开查看完整内容

### 交互

- 持仓卡片默认展示"结论+简要理由"，点击展开详细分析
- 机会雷达/新机会区域，没有信号时隐藏
- 日报以文字+数据卡片为主，不堆图表，保证加载快
- 周报保留必要图表（宏观评分仪表盘、资金流向柱状图）

### 报告标识

每份报告显示：
- 日期 + 时间标签：`2026-02-04 17:30 日报` / `2026-02-01 周报（周六）`
- 报告类型 badge

---

## 后端架构

### 新增：报告存储表 `generated_report`

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| report_type | enum | daily / weekly |
| report_date | date | 报告对应日期 |
| generated_at | datetime | 生成时间 |
| summary | text | 一句话摘要（用于列表折叠展示） |
| content | JSON | 完整报告数据 |

### 调度时间

| 任务 | 时间 | 说明 |
|------|------|------|
| 数据采集（A股） | 17:00 | 收盘数据入库 |
| 日报生成 #1 | 17:30 | A股收盘后，全市场分析 |
| 数据采集（美股隔夜） | 06:30 | 美股收盘数据入库 |
| 日报生成 #2 | 07:00 | 美股收盘后，全市场分析 |
| 周报生成 #1 | 周六 07:00 | 本周完整分析 |
| 周报生成 #2 | 周日 22:00 | 补充周末消息，睡前看 |

### AI点评生成流程

1. 取所有 ACTIVE 持仓 + 最新行情 + 信号
2. 对每只持仓调用 AI（FAST模型）生成：
   - 短点评（结论+理由，2-3句）
   - 操作建议标签（持有/关注/减仓/加仓）
   - 详细分析（基本面、技术面、催化剂、风险点）
3. 扫描关注列表 + 关联板块，生成机会信号
4. 生成总览摘要
5. 整体打包为 JSON 存入 `generated_report` 表

### API 端点

| 端点 | 说明 |
|------|------|
| `GET /api/reports/daily` | 日报列表（分页，默认最近10份） |
| `GET /api/reports/daily/{id}` | 单份日报详情 |
| `GET /api/reports/weekly` | 周报列表（分页，默认最近10份） |
| `GET /api/reports/weekly/{id}` | 单份周报详情 |

列表接口返回：`id, report_date, generated_at, summary`（轻量）
详情接口返回：完整 `content` JSON

---

## 与现有系统的关系

- **保留**：所有现有分析器（宏观、资金流向、商品、持仓健康、关注列表），作为数据源
- **改造**：ReportService 的 `generate_daily_report` 和 `generate_weekly_report`，输出存入新表
- **新增**：逐只持仓AI点评逻辑、机会雷达扫描逻辑、报告存储表
- **前端重写**：Reports.vue + 所有 section 组件替换为新设计
